filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Age == '18+ yrs') %>%
mutate(Geography = 'Upper')
df_to_plot_lower <- fingertips_data(IndicatorID = obesity_indicator, AreaTypeID = 101) %>%
filter(AreaName %in% areas_of_interest_ds_and_bs) %>%
mutate(Geography = 'Lower')
# We use AreaTypeID = 102 to get upper tier local authorities e.g. West Sussex and its CIPFA neighbours
# But we also need lower tier local authorities (Adur, Arun, etc) - this is AreaTypeID = 101
# For more information on areas in the Fingertips, run this code
# areas <- area_types()
# View(areas)
# Let's bind together the data sets we have
# NB we only need West Sussex from the UTLA data this time around
df_plot_all <-rbind(df_to_plot_lower, df_to_plot_upper) %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
arrange(-Value) %>%
mutate(AreaName = forcats::fct_rev(forcats::fct_inorder(AreaName)),
AreaName = forcats::fct_relevel(AreaName, rev(areas_of_interest), after = Inf),
Geography = forcats::fct_relevel(Geography, c('Upper','Lower')),
AreaType = forcats::fct_relevel(AreaType, c('England','Region','County & UA (pre 4/19)','District & UA (pre 4/19)')))
(df_plot_all$AreaType %>% unique())
#  Plot 1 is a bar chart comparing West Sussex and LTLAs to the England rate
# This outputs all the possible values in this column
# (df_plot_all$ComparedtoEnglandvalueorpercentiles %>% unique)
rag_colours <- c('Better' ='green','Similar'='orange','Not compared'='gray','Worse'='red')
# An added complication in this plot is that we need England, South East and West Sussex up top, and then the LTLAs in order of their rates
# Nice to have: skip a bar between these values and the LTLAs - not working at the moment, might revisit at some point possibly with facets
# Another variation is fixed order for LTLAs as well
# FYI This is a helpful blog post on all things bar chart: https://www.cedricscherer.com/2021/07/05/a-quick-how-to-on-labelling-bar-graphs-in-ggplot2/
indicator_name <- df_plot_all$IndicatorName %>% unique()
# %>% str_replace('^Cancer ','% ') %>% str_to_title() %>% str_wrap(width = 40)
indicator_caption <- paste0('PHE Fingertips, ', df_plot_all$Timeperiod %>% unique())
obese_rag <- ggplot(
data = df_plot_all,
mapping = aes(x = Value, y = AreaName, fill = ComparedtoEnglandvalueorpercentiles)) +
geom_bar(stat = 'identity')+
scale_fill_manual(values = rag_colours)+
theme_wsj() +
scale_color_ft() +
facet_grid(AreaType ~ ., scales = 'free', space = 'free') +
theme(legend.position = 'none',
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.x = element_text(colour = 'black', size=rel(1)),
strip.text = element_blank()) +
labs(x = indicator_name)#,       caption = indicator_caption)
print(obese_rag)
ggsave(obese_rag, filename = 'obesity_rag_bar.png', path = save_place, bg = 'transparent', units = 'mm', width = 180, height = 100)
# Packages
library(tidyverse)
library(hrbrthemes)
library(fingertipsR)
library(ggthemes)
library(ggtext)
# Configure location for source files
source_place <- '~/Documents/JSNA/latex_summary/data_sources'
# Configure location for saving files
save_place <- '~/Documents/JSNA/latex_summary/images'
# Fingertips-y stuff
inds <- indicators()
### MY VARIABLES
XXXX <- 40601
YYYY <- "Under 75 mortality rate from liver disease"
ZZZZ <- "u75_liver_line"
##
le_indicator <- XXXX
View(inds)
### MY VARIABLES
XXXX <- 90861
YYYY <- "Under 75 mortality rate from liver disease"
ZZZZ <- "u75_liver_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons')
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
##geom_richtext(x='2011 - 13', y=82.5, label=caption, stat = 'unique', color = 'black', hjust=0, fill = NA, label.color = NA, size = rel(5)) +
expand_limits(y = c(0, 25)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
View(df)
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
filter(Timeperiodrange == '1yr') %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Timeperiodrange == '1yr')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
filter(Timeperiodrange == '1yr') %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
##geom_richtext(x='2011 - 13', y=82.5, label=caption, stat = 'unique', color = 'black', hjust=0, fill = NA, label.color = NA, size = rel(5)) +
expand_limits(y = c(0, 25)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Timeperiodrange == '1yr')
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Timeperiodrange == '1y')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
filter(Timeperiodrange == '1yr') %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
##geom_richtext(x='2011 - 13', y=82.5, label=caption, stat = 'unique', color = 'black', hjust=0, fill = NA, label.color = NA, size = rel(5)) +
expand_limits(y = c(0, 25)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
YYYY <- "Under 75 mortality rate from liver disease (1yr range)"
ZZZZ <- "u75_liver_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Timeperiodrange == '1y')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
filter(Timeperiodrange == '1yr') %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
##geom_richtext(x='2011 - 13', y=82.5, label=caption, stat = 'unique', color = 'black', hjust=0, fill = NA, label.color = NA, size = rel(5)) +
expand_limits(y = c(0, 25)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = paste0(ZZZZ,".png"),path = save_place, bg = 'transparent', units = 'mm', width = 235, height = 130)
YYYY <- "Under 75 mortality rate from liver disease (3yr range)"
ZZZZ <- "u75_liver_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons') %>%
filter(Timeperiodrange == '3y')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
caption_data <- df %>%
filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
filter(Timeperiodrange == '1yr') %>%
select(AreaName,Value,Timeperiod) %>%
mutate(Value = round(Value,1))
caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' YYYY**<br>',caption_data[2,1],' = ',caption_data[2,2],' years<br>',caption_data[1,1],' = ',caption_data[1,2],' years')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
##geom_richtext(x='2011 - 13', y=82.5, label=caption, stat = 'unique', color = 'black', hjust=0, fill = NA, label.color = NA, size = rel(5)) +
expand_limits(y = c(0, 25)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = paste0(ZZZZ,".png"),path = save_place, bg = 'transparent', units = 'mm', width = 235, height = 130)
# 03-abns-lt10wks.r
# Under 25s repeat abortions (%)
# Packages
library(tidyverse)
library(hrbrthemes)
library(ggthemes)
library(ggtext)
# Configure location for source files
source_place <- '~/Documents/JSNA/latex_summary/data_sources'
# Configure location for saving files
save_place <- '~/Documents/JSNA/latex_summary/images'
# We don't use the fingertips package for this as it doesn't return local authority
# level data. Instead we'll build a tibble based on data from the fingertips website.
df <- tibble(
Timeperiod = rep(seq.int(2012,2020),2),
AreaName = c(rep("West Sussex",9), rep("England",9)),
Value = c(75.8,77.6,NA,79.4,78.2,73.4,77.2,80.2,88.7,77.5,79.4,80.4,80.3,80.8,76.6,80.3,82.5,88.1)
)
YYYY="Abortions under 10 weeks (%)"
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
# caption_data <- df %>%
#   filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
#   select(AreaName,Value,Timeperiod) %>%
#   mutate(Value = round(Value,1))
#
# caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' ',YYYY,'**<br>',caption_data[2,1],' = ',caption_data[2,2],' per 100,000 population<br>',caption_data[1,1],' = ',caption_data[1,2],' per 100,000 population')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(70, 90)) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = paste0("abortions_lt_10wks_line",".png"),path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 100)
ggsave(plot, filename = paste0("abortions_lt_10wks_line",".png"),path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
# 03-ct_diag-line.r
# Under 25s repeat abortions (%)
# Packages
library(tidyverse)
library(hrbrthemes)
library(fingertipsR)
library(ggthemes)
library(ggtext)
# Configure location for source files
source_place <- '~/Documents/JSNA/latex_summary/data_sources'
# Configure location for saving files
save_place <- '~/Documents/JSNA/latex_summary/images'
# Fingertips-y stuff
inds <- indicators()
### MY VARIABLES
XXXX <- 91521
YYYY <- "Chlamydia diagnostic rate / 100,000"
ZZZZ <- "ct_diag_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Female')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(1,length(indicator_timeperiod),2)] <- ''
# caption_data <- df %>%
#   filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
#   select(AreaName,Value,Timeperiod) %>%
#   mutate(Value = round(Value,1))
#
# caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' ',YYYY,'**<br>',caption_data[2,1],' = ',caption_data[2,2],' per 100,000 population<br>',caption_data[1,1],' = ',caption_data[1,2],' per 100,000 population')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(0, 10)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = paste0(ZZZZ,".png"),path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
# Packages
library(tidyverse)
library(hrbrthemes)
library(fingertipsR)
library(ggthemes)
library(ggtext)
# Configure location for source files
source_place <- '~/Documents/JSNA/latex_summary/data_sources'
# Configure location for saving files
save_place <- '~/Documents/JSNA/latex_summary/images'
# Fingertips-y stuff
inds <- indicators()
### MY VARIABLES
XXXX <- 91521
YYYY <- "Chlamydia diagnostic rate / 100,000"
ZZZZ <- "ct_diag_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Female')
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
View(df)
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(1,length(indicator_timeperiod),2)] <- ''
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(0, 10)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = "repeat_abortions_line.png", path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),1)] <- ''
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(0, 10)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = "repeat_abortions_line.png", path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
### MY VARIABLES
XXXX <- 90741
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 402)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Female')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(0, 10)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = "repeat_abortions_line.png", path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
# 03-ct_diag-line.r
# Under 25s repeat abortions (%)
# Packages
library(tidyverse)
library(hrbrthemes)
library(fingertipsR)
library(ggthemes)
library(ggtext)
# Configure location for source files
source_place <- '~/Documents/JSNA/latex_summary/data_sources'
# Configure location for saving files
save_place <- '~/Documents/JSNA/latex_summary/images'
# Fingertips-y stuff
inds <- indicators()
### MY VARIABLES
XXXX <- 91521
YYYY <- "Chlamydia diagnostic rate / 100,000"
ZZZZ <- "ct_diag_line"
##
le_indicator <- XXXX
df <- fingertips_data(IndicatorID = le_indicator, AreaTypeID = 102)
areas_of_interest <- c('England', 'South East Region', 'West Sussex')
df <- df %>%
filter(AreaName %in% areas_of_interest) %>%
filter(Sex == 'Persons')
indicator_timeperiod <- df$Timeperiod %>% unique() %>% sort()
indicator_timeperiod[seq(2,length(indicator_timeperiod),2)] <- ''
# caption_data <- df %>%
#   filter(TimeperiodSortable == max(TimeperiodSortable)) %>%
#   select(AreaName,Value,Timeperiod) %>%
#   mutate(Value = round(Value,1))
#
# caption <- paste0('**',str_replace_all(caption_data[2,3],' ',''),' ',YYYY,'**<br>',caption_data[2,1],' = ',caption_data[2,2],' per 100,000 population<br>',caption_data[1,1],' = ',caption_data[1,2],' per 100,000 population')
plot <- ggplot(
data = df,
mapping = aes(x = Timeperiod, y = Value, color = AreaName, group=AreaName))+
geom_line(size=2) +
geom_point(shape=21, size=3, fill = 'white', stroke = 3) +
expand_limits(y = c(0, 10)) +
scale_x_discrete(labels = indicator_timeperiod) +
theme_wsj() +
scale_color_ft() +
theme(legend.position = c(.85,.1),
legend.title = element_blank(),
legend.text = element_text(size = rel(1)),
title = element_text(family = "sans", size = rel(1)),
rect = element_rect(fill = 'transparent', linetype = 0, colour = NA),
axis.title.y = element_text(colour = 'black', size=rel(1))) +
labs(y=YYYY)
plot
ggsave(plot, filename = paste0(ZZZZ,".png"),path = save_place, bg = 'transparent', units = 'mm', width = 220, height = 90)
